{{data-source src=(concat '/' dc '/service/' slug) onchange=(action (mut item) value='data') onerror=(action (mut error) value='error')}}

{{#if (and (is-undefined item) (eq error.errors.firstObject.status '404'))}}
  {{app-error error=error.errors.firstObject}}
{{else}}
  {{#app-view class="service show" loading=(not (is-defined item))}}
      {{#block-slot 'notification2'}}
        {{#if (eq error.errors.firstObject.status '404')}}
          <div class="flash-message">
            <p data-notification class="warning notification-update">
              <strong>
                Warning!
              </strong>
              This service has been deregistered and no longer exists in the catalog.
            </p>
          </div>
        {{/if}}
      {{/block-slot}}
      {{#block-slot 'breadcrumbs'}}
          <ol>
              <li><a data-test-back href={{href-to 'dc.services'}}>All Services</a></li>
          </ol>
      {{/block-slot}}
      {{#block-slot 'header'}}
        <h1>
          {{ item.Service.Service }}

  {{#with (service/external-source item.Service) as |externalSource| }}
    {{#with (css-var (concat '--' externalSource '-color-svg') 'none') as |bg| }}
      {{#if (not-eq bg 'none') }}
          <span data-test-external-source="{{externalSource}}" style={{{ concat 'background-image:' bg }}} data-tooltip="Registered via {{externalSource}}">Registered via {{externalSource}}</span>
      {{/if}}
    {{/with}}
  {{/with}}

  {{#if (eq item.Service.Kind 'connect-proxy')}}
          <span class="kind-proxy">Proxy</span>
  {{/if}}
        </h1>
        <label for="toolbar-toggle"></label>
        {{tab-nav
            items=(array
              'Instances'
              'Tags'
            )
            selected=selectedTab
        }}
      {{/block-slot}}
      {{#block-slot 'actions'}}
        {{#if urls.service}}
          {{#templated-anchor data-test-dashboard-anchor href=urls.service vars=(hash Datacenter=dc Service=(hash Name=item.Service.Service)) rel="external"}}Open Dashboard{{/templated-anchor}}
        {{/if}}
      {{/block-slot}}
      {{#block-slot 'content'}}
          {{#each
            (array
              (slugify 'Instances')
              (slugify 'Tags')
            ) as |panel|
          }}
              {{#tab-section id=panel selected=(eq (if selectedTab selectedTab '') panel) onchange=(action "change")}}
                {{#if (eq panel 'instances')}}
                  {{#if (gt item.Nodes.length 0) }}
                    <input type="checkbox" id="toolbar-toggle" />
                    <form class="filter-bar">
                      {{freetext-filter onchange=(action (mut s) value='target.value') value=s placeholder="Search"}}
                    </form>
                    {{#changeable-set dispatcher=(searchable 'serviceInstance' item.Nodes s)}}
                      {{#block-slot 'set' as |filtered|}}
                        {{consul-service-instance-list items=filtered}}
                      {{/block-slot}}
                    {{/changeable-set}}
                  {{/if}}
                {{else}}
                  {{#if (gt item.Tags.length 0) }}
                    {{tag-list items=item.Tags}}
                  {{else}}
                    <p>
                      There are no tags.
                    </p>
                  {{/if}}
                {{/if}}
              {{/tab-section}}

          {{/each}}
      {{/block-slot}}
  {{/app-view}}
{{/if}}
